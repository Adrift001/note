<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MySQL约束 - Optional Note</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Optional Note</a></li><li class="chapter-item expanded "><a href="../MySQL.html"><strong aria-hidden="true">2.</strong> MySQL</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../MySQL/1-MySQL基础.html"><strong aria-hidden="true">2.1.</strong> MySQL基础</a></li><li class="chapter-item expanded "><a href="../MySQL/2-MySQL约束.html" class="active"><strong aria-hidden="true">2.2.</strong> MySQL约束</a></li><li class="chapter-item expanded "><a href="../MySQL/3-MySQL多表&事务.html"><strong aria-hidden="true">2.3.</strong> MySQL多表&amp;事务</a></li></ol></li><li class="chapter-item expanded "><a href="../JDBC.html"><strong aria-hidden="true">3.</strong> JDBC</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../JDBC/JDBC连接池&JDBCTemplate.html"><strong aria-hidden="true">3.1.</strong> JDBC连接池&amp;JDBCTemplate</a></li></ol></li><li class="chapter-item expanded "><a href="../MyBatis.html"><strong aria-hidden="true">4.</strong> MyBatis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../MyBatis/1-MyBatis入门.html"><strong aria-hidden="true">4.1.</strong> MyBatis入门.md</a></li><li class="chapter-item expanded "><a href="../MyBatis/2-自定义MyBatis.html"><strong aria-hidden="true">4.2.</strong> 自定义MyBatis.md</a></li><li class="chapter-item expanded "><a href="../MyBatis/3-MyBatis-CRUD.html"><strong aria-hidden="true">4.3.</strong> MyBatis-CRUD.md</a></li><li class="chapter-item expanded "><a href="../MyBatis/4-MyBatis-Dao开发.html"><strong aria-hidden="true">4.4.</strong> MyBatis-Dao开发.md</a></li><li class="chapter-item expanded "><a href="../MyBatis/5-MyBatis连接池及事务.html"><strong aria-hidden="true">4.5.</strong> MyBatis连接池及事务.md</a></li><li class="chapter-item expanded "><a href="../MyBatis/6-动态SQL.html"><strong aria-hidden="true">4.6.</strong> 动态SQL.md</a></li><li class="chapter-item expanded "><a href="../MyBatis/7-MyBatis多表操作.html"><strong aria-hidden="true">4.7.</strong> MyBatis多表操作.md</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Optional Note</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="目录"><a class="header" href="#目录">目录</a></h1>
<ol>
<li>DQL: 查询语句
<ol>
<li>排序查询</li>
<li>聚合函数</li>
<li>分组查询</li>
<li>分页查询</li>
</ol>
</li>
<li>约束</li>
<li>多表时间的关系</li>
<li>范式</li>
<li>数据库备份和还原</li>
</ol>
<h2 id="dql-查询语句"><a class="header" href="#dql-查询语句">DQL: 查询语句</a></h2>
<ol>
<li>
<p>排序查询</p>
<pre><code class="language-sql ignore">order by 子句;
	order by 排序字段1 排序方式2, 排序字段2 排序方式2...
排序方式: 
	ASC: 升序
	DESC: 降序
-- 按照数学排序, 如果数学一样, 则按照英语排序
SELECT * FROM student ORDER BY math, english;
-- 如果有多个排序条件, 则当前面的条件值一样时, 才会判断第二个条件.
</code></pre>
</li>
<li>
<p>聚合函数: 将一列数据做整体, 进行纵向计算.</p>
<ol>
<li>
<p>count: 计算个数</p>
<blockquote>
<p>一般选择非空的列, 例如: 主键</p>
</blockquote>
</li>
<li>
<p>max: 计算最大值</p>
</li>
<li>
<p>min: 计算最小值</p>
</li>
<li>
<p>avg: 计算平均值</p>
<blockquote>
<p>聚合函数的计算, 排除null值了.
解决方法:</p>
<ol>
<li>选择不包含非空的列</li>
<li>IFNULL函数</li>
</ol>
</blockquote>
<pre><code class="language-sql ignore">SELECT COUNT(`name`) FROM student;

SELECT COUNT(IFNULL(english,0)) FROM student;

SELECT MAX(math) FROM student;

SELECT MIN(math) FROM student;

SELECT SUM(math) FROM student;

SELECT AVG(math) FROM student;
</code></pre>
</li>
</ol>
</li>
<li>
<p>分组查询</p>
<pre><code class="language-sql ignore">group by 分组字段;
</code></pre>
<blockquote>
<p>分组之后可以查询的字段:  分组字段, 聚合函数</p>
<p>where 和 having区别: </p>
<p>​	where在分组之前限定, 如果不满足条件, 不参与分组</p>
<p>​	having在分组之后限定, 如果不满足having条件, 不被查询</p>
</blockquote>
<pre><code class="language-sql ignore">-- 按性别分组并计算平均分
SELECT sex, AVG(math), COUNT(id) FROM student GROUP BY sex;

-- 按性别分组并计算分数大于70分的平均分
SELECT sex, AVG(math), COUNT(id) FROM student WHERE math &gt; 70 GROUP BY sex;

-- 按性别分组并计算分数大于70分的平均分, 并且分组之后分数大于2
SELECT sex, AVG(math), COUNT(id) FROM student WHERE math &gt; 70 GROUP BY sex HAVING COUNT(id) &gt; 2;
SELECT sex, AVG(math), COUNT(id) 人数 FROM student WHERE math &gt; 70 GROUP BY sex HAVING 人数 &gt; 2;
</code></pre>
</li>
<li>
<p>分页查询</p>
<pre><code class="language-sql ignore">limit 开始索引, 查询的条数
</code></pre>
<pre><code class="language-sql ignore">-- 每页显示三条记录
SELECT * FROM student LIMIT 0,3; -- 第一页
SELECT * FROM student LIMIT 3,3; -- 第二页
-- 公式: 开始的索引 = (当前页码 - 1) * 每页数
SELECT * FROM student LIMIT 6,3;  -- 第三页
</code></pre>
<blockquote>
<p>limit是一个MySQL的<code>方言</code></p>
</blockquote>
</li>
</ol>
<h2 id="约束"><a class="header" href="#约束">约束</a></h2>
<ul>
<li>
<p>概念: 对表中的数据进行限定, 保证数据的正确性, 有效性和完整性.</p>
</li>
<li>
<p>分类: </p>
<ol>
<li>主键约束: primary key</li>
<li>非空约束: not null</li>
<li>唯一约束: unique</li>
<li>外键约束: foreign key</li>
</ol>
<h3 id="主键约束"><a class="header" href="#主键约束">主键约束</a></h3>
<blockquote>
<ol>
<li>非空且唯一</li>
<li>一个表只能有一个字段是主键</li>
<li>主键就是表中记录的唯一标识</li>
</ol>
</blockquote>
<ol>
<li>
<p>创建表时添加主键</p>
<pre><code class="language-sql ignore">CREATE TABLE stu(id INT PRIMARY KEY, name VARCHAR(20));
</code></pre>
</li>
<li>
<p>创建表之后添加主键</p>
<pre><code class="language-sql ignore">ALTER TABLE stu MODIFY id INT PRIMARY KEY;
</code></pre>
</li>
<li>
<p>删除主键</p>
<pre><code class="language-sql ignore">ALTER TABLE stu MODIFY id int; -- 错误,不生效
ALTER TABLE stu DROP PRIMARY KEY;
</code></pre>
</li>
<li>
<p>自动增长</p>
<ul>
<li>
<p>如果某一列是数值类型, 使用<code>auto_increment</code>可以用来完成值的自动增长.</p>
<pre><code class="language-sql ignore">-- 创建表时添加自动增长
CREATE TABLE stu(id INT PRIMARY KEY AUTO_INCREMENT, name VARCHAR(20));

-- 删除自动增长
ALTER TABLE stu MODIFY id INT;

-- 添加自动增长
ALTER table stu MODIFY id INT PRIMARY KEY AUTO_INCREMENT;
</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="非空约束-not-null"><a class="header" href="#非空约束-not-null">非空约束: not null</a></h3>
<ol>
<li>
<p>创建表时添加约束</p>
<pre><code class="language-sql ignore">CREATE TABLE stu(id INT, name VARCHAR(20) NOT NULL);
</code></pre>
</li>
<li>
<p>创建表完之后添加非空约束</p>
<pre><code class="language-sql ignore">ALTER TABLE stu MODIFY `name` VARCHAR(20) NOT NULL;
ALTER TABLE stu CHANGE `name` `name` VARCHAR(20) NOT NULL;
</code></pre>
</li>
<li>
<p>删除非空约束</p>
<pre><code class="language-sql ignore">ALTER TABLE stu MODIFY `name` VARCHAR(20);
ALTER TABLE stu CHANGE `name` `name` VARCHAR(20);
</code></pre>
</li>
</ol>
<h3 id="唯一约束-unique"><a class="header" href="#唯一约束-unique">唯一约束: unique</a></h3>
<p>同一列的值不能重复</p>
<ol>
<li>
<p>创建表时添加唯一约束</p>
<pre><code class="language-sql ignore">CREATE TABLE stu(id INT, phone VARCHAR(20) UNIQUE);
-- 注意: MySQL中, 唯一约束限定的列的值可以有多个null
</code></pre>
</li>
<li>
<p>创建表后添加</p>
<pre><code class="language-sql ignore">ALTER TABLE stu MODIFY phone VARCHAR(20) UNIQUE;
</code></pre>
</li>
<li>
<p>删除唯一约束</p>
<pre><code class="language-sql ignore">ALTER TABLE stu MODIFY phone VARCHAR(20); -- 不能通过这种方式
ALTER TABLE stu DROP INDEX phone;
</code></pre>
</li>
</ol>
<blockquote>
<p>注意: MySQL中唯一约束限定的列的值可以有多个null</p>
</blockquote>
<h3 id="外键约束"><a class="header" href="#外键约束">外键约束</a></h3>
<pre><code class="language-sql ignore">CREATE TABLE emp (
   id INT PRIMARY KEY AUTO_INCREMENT,
   NAME VARCHAR(30),
   age INT,
   dep_name VARCHAR(30),
   dep_location VARCHAR(30)
);
</code></pre>
<pre><code class="language-sql ignore">-- 添加数据
INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES ('张三', 20, '研发部', '广州');
INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES ('李四', 21, '研发部', '广州');
INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES ('王五', 20, '研发部', '广州');
INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES ('老王', 20, '销售部', '深圳');
INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES ('大王', 22, '销售部', '深圳');
INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES ('小王', 18, '销售部', '深圳');
</code></pre>
<pre><code class="language-sql ignore">-- 数据有冗余

-- 解决方案：分成 2 张表
-- 创建部门表(id,dep_name,dep_location)
-- 一方，主表
create table department(
   id int primary key auto_increment,
   dep_name varchar(20),
   dep_location varchar(20)
);

-- 创建员工表(id,name,age,dep_id)
-- 多方，从表
create table employee(
   id int primary key auto_increment,
   name varchar(20),
   age int,
   dep_id int,  -- 外键对应主表的主键
   CONSTRAINT emp_dept_fk FOREIGN KEY (dep_id) REFERENCES department(id)
);

-- 添加 2 个部门
insert into department values(null, '研发部','广州'),(null, '销售部', '深圳');
select * from department;

-- 添加员工,dep_id 表示员工所在的部门
INSERT INTO employee (NAME, age, dep_id) VALUES ('张三', 20, 1);
INSERT INTO employee (NAME, age, dep_id) VALUES ('李四', 21, 1);
INSERT INTO employee (NAME, age, dep_id) VALUES ('王五', 20, 1);
INSERT INTO employee (NAME, age, dep_id) VALUES ('老王', 20, 2);
INSERT INTO employee (NAME, age, dep_id) VALUES ('大王', 22, 2);
INSERT INTO employee (NAME, age, dep_id) VALUES ('小王', 18, 2);
select * from employee;
</code></pre>
<pre><code class="language-sql ignore">-- 删除外键
ALTER TABLE employee DROP FOREIGN KEY emp_dept_fk;

-- 添加外键
ALTER TABLE employee ADD CONSTRAINT emp_dept_fk FOREIGN KEY (dep_id) REFERENCES department(id);

emp_dept_fk是外键名称

-- 添加外键, 设置级联更新
ALTER TABLE employee ADD CONSTRAINT emp_dept_fk FOREIGN KEY (dep_id) REFERENCES department(id) ON UPDATE CASCADE;

-- 添加外键, 设置级联删除
ALTER TABLE employee ADD CONSTRAINT emp_dept_fk FOREIGN KEY (dep_id) REFERENCES department(id) ON DELETE CASCADE;

-- 同时设置
ALTER TABLE employee ADD CONSTRAINT emp_dept_fk FOREIGN KEY (dep_id) REFERENCES department(id) ON UPDATE CASCADE ON DELETE CASCADE;
</code></pre>
</li>
</ul>
<h2 id="数据库的设计"><a class="header" href="#数据库的设计">数据库的设计</a></h2>
<ol>
<li>
<p>多表之间的关系</p>
<ol>
<li>
<p>分类</p>
<ol>
<li>一对一:
<ul>
<li>人和身份证</li>
<li>分析: 一个人有一个身份证, 一个身份证对应一个人</li>
</ul>
</li>
<li>一对多(多对一):
<ul>
<li>部门和员工</li>
<li>分析: 一个部门有多个员工, 一个员工只能对应一个部门</li>
</ul>
</li>
<li>多对多:
<ul>
<li>如: 学生和课程</li>
<li>分析: 一个学生可以选择多个课程, 一个课程可以被多个学生选择</li>
</ul>
</li>
</ol>
</li>
<li>
<p>实现:</p>
<ol>
<li>一对多:
<ul>
<li>部门和员工</li>
<li>实现方式: 在多的一方建立外键, 指向一的一方的主键.</li>
</ul>
</li>
<li>多对多:
<ul>
<li>学生和课程</li>
<li>实现方式: 多对多关系实现需要借助第三张中间表,中间表至少包含两个字段, 这两个字段作为第三张表的外键, 分别指向其他两张表的主键.</li>
</ul>
</li>
<li>一对一:
<ul>
<li>学生和身份证</li>
<li>实现方式: 可以在任意一方添加唯一(unique)外键指向另一方的主键.</li>
</ul>
</li>
</ol>
</li>
<li>
<p>案例: </p>
<p>分类表</p>
<table><thead><tr><th>cid</th><th>ame</th></tr></thead><tbody>
<tr><td>x</td><td>x</td></tr>
</tbody></table>
<p>线路表</p>
<table><thead><tr><th>rid</th><th>name</th><th>price</th><th>cid</th></tr></thead><tbody>
<tr><td></td><td></td><td></td><td></td></tr>
</tbody></table>
<p>用户表</p>
<table><thead><tr><th>uid</th><th>username</th><th>password</th></tr></thead><tbody>
<tr><td></td><td></td><td></td></tr>
</tbody></table>
<p>中间表</p>
<table><thead><tr><th>rid</th><th>uid</th></tr></thead><tbody>
<tr><td></td><td></td></tr>
</tbody></table>
<p>分类1     线路表N  一对多</p>
<p>线路表N  用户M 多对多, 中间表</p>
</li>
</ol>
</li>
<li>
<p>数据库设计的范式</p>
<ol>
<li>第一范式: 每一列都是不可分割的原子数据项</li>
<li>第二范式: 在1NF的基础上,非码属性必须完全依赖于候选码(在1NF基础上消除非主属性对主码的部分函数依赖)</li>
<li>第三方是: 在2NF的基础上, 任何非主属性不依赖于其他非主属性(在2NF基础上消除传递依赖)</li>
</ol>
</li>
</ol>
<h2 id="数据库备份和还原"><a class="header" href="#数据库备份和还原">数据库备份和还原</a></h2>
<ol>
<li>命令行
<ul>
<li>mysqldump -u用户名 -p密码 数据库名称 &gt; 保存路径</li>
<li>还原
<ol>
<li>登录数据库</li>
<li>创建数据库</li>
<li>使用数据库</li>
<li>执行文件. source 文件路径</li>
</ol>
</li>
</ul>
</li>
<li>图形化工具</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../MySQL/1-MySQL基础.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../MySQL/3-MySQL多表&amp;事务.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../MySQL/1-MySQL基础.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../MySQL/3-MySQL多表&amp;事务.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
